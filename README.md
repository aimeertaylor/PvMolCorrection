# PvMolCorrection

*Plasmodium vivax* molecular correction using Pv3Rs: a re-analysis of *P. vivax*
genetic data from the Vivax History (VHX) 
[Chu et al. Clin. Infect. Dis. 67, 1543–1549 (2018)](https://academic.oup.com/cid/article/67/10/1543/5034800) and 
Best Primaquine Dose 
[Chu et al. Clin. Infect. Dis. 68, 1311–1319 (2018)](https://academic.oup.com/cid/article/68/8/1311/5079011)
trials. The original analysis on which this re-analysis is based is described in 
[Taylor & Watson et al. 2019](https://www.nature.com/articles/s41467-019-13412-x). 
The re-analysis uses original input and output from
jwatowatson-RecurrentVivax-4870715, which was downloaded from
[/records/3368828](https://zenodo.org/records/3368828), and from MS_Final which
was saved as MS_final_generated_by_running_all_chunks_of_Pooled_Analysis.Rmd
after running Pooled_Analysis.Rmd in jwatowatson-RecurrentVivax-4870715.

The following steps re-produce this analysis: 

1) Install Pv3Rs; see [Pv3Rs](https://github.com/aimeertaylor/Pv3Rs)

2) Download `jwatowatson-RecurrentVivax-4870715/` from 
[/records/3368828](https://zenodo.org/records/3368828) and save it in PvMolCorrection/

3) Run `jwatowatson-RecurrentVivax-4870715 2/Pooled_Final_Analysis/Pooled_Analysis.Rmd` 
and save MS_Final as `MS_final_generated_by_running_all_chunks_of_Pooled_Analysis.Rmd` in 
PvMolCorrection/RData.

2) Run Compute_recurrent_states_Pv3Rs.R: takes several hours and generates 
  - prior_estimates.RData 
  - results_Pv3Rs.RData
 
3) Run Analysable_data.R: generates
  - tab_MOIs.csv
  - data_paired.png
  - data_unestimatable.png

4) Run Extract_and_plot_Pv3Rs.R: generates
 - marg_results_Pv3Rs.RData
 - simplex_Pv3Rs.png
 
5) Run Extract_and_plot_prototype.R: generates
 - simplex_prototype.png
 - compare_Pv3Rs_vs_prototype.png
 - data_Pv3Rs_vs_prototype.png
 
6) Run Compute_failure_rates.R to generate 
  - compare_failure_rates.png
 
7) Run Compare_joint_pwise_Pv3Rs.R to generate 
  - compare_joint_vs_pwise.png
  - data_joint_vs_pwise.png

Cherry_picked_examples.R does not yet feature in any written reports. To better
understand data input and estimates generated by the prototype (can be skipped),
run the Understanding_*.R scripts, noting that Understanding_priors.R requires
prior_estimates.RData to be first generated by running
Compute_recurrent_states_Pv3Rs.R
